# JOYSTICK_ADAPTOR

โปรเจ็กต์นี้เป็นตัวอย่างการเชื่อมต่อรีซีฟเวอร์แบบ IBus กับบอร์ด ESP32 พร้อมกับควบคุม LED ผ่านไดรเวอร์ PCA9685 โดยใช้เฟรมเวิร์ก Arduino บน PlatformIO

## คุณสมบัติ

- อ่านค่าจากรีซีฟเวอร์ IBus ได้สูงสุด 8 ช่องสัญญาณ
- ควบคุม LED 5 ดวงผ่านไดรเวอร์ PCA9685
- ทำงานแบบ Multitask ด้วย FreeRTOS ได้แก่
  - อ่านค่า IBus
  - ควบคุม LED ตามอินพุต
  - กระพริบ LED สถานะ
- รองรับสองโหมดหลัก
  - **Manual**: LED ทำงานตามอินพุตจากรีซีฟเวอร์
  - **Auto**: สลับไฟ LED1-4 แบบอัตโนมัติเมื่อสั่งด้วย CH3

## Hardware Configuration

- บอร์ด: `ioxesp32ps` (ESP32)
- Serial2 (GPIO16, GPIO17) ใช้สำหรับรับสัญญาณ IBus ที่ความเร็ว 115200
- โมดูล PCA9685 เชื่อมต่อผ่านบัส I2C (`Wire`) ความถี่ PWM 1 kHz
- การแม็ปช่องสัญญาณ LED ของ PCA9685
  - CH0: LED1
  - CH1: LED2
  - CH2: LED3
  - CH3: LED4
  - CH4: LED5 (ไฟแสดงสถานะ)

## ฟังก์ชันหลักในโค้ด

- `mapDirection(val)` – แปลงค่าพัลส์จาก IBus ให้เป็นทิศทาง -1, 0, 1
- `taskReadIBus()` – อ่านค่าแชนเนลจาก IBus อย่างต่อเนื่อง
- `taskControlLED()` – ควบคุม LED ตามโหมดปัจจุบันและสัญญาณที่รับได้
- `taskFlashLED5()` – กระพริบ LED5 เมื่ออยู่ในโหมด Auto

## ขั้นตอนการใช้งาน

1. ติดตั้ง [PlatformIO](https://platformio.org/) และคลอนโปรเจ็กต์นี้ลงเครื่อง
2. เชื่อมต่อรีซีฟเวอร์ IBus เข้ากับขา RX/TX ของ Serial2 (GPIO16/17)
3. ต่อโมดูล PCA9685 เข้ากับบัส I2C ของ ESP32
4. คอมไพล์และอัปโหลดเฟิร์มแวร์ด้วยคำสั่ง
   ```
   pio run -e ioxesp32ps
   pio run -e ioxesp32ps_pca9685   # สำหรับไฟล์ตัวอย่างสั้น
   ```
5. เมื่อติดตั้งเสร็จ บอร์ดจะเริ่มในโหมด Manual (LED5 ติดค้าง)
6. ใช้สัญญาณจากรีซีฟเวอร์ควบคุม LED1–4 ตามทิศทางของ CH1–CH2
7. หากต้องการเข้าโหมด Auto ให้ดันสวิตช์บน CH3 ค้างประมาณ 3 วินาที
8. ในโหมด Auto LED5 จะกระพริบและ LED1–4 จะทำงานวนลูปอัตโนมัติ
9. ปลด CH3 เพื่อกลับสู่โหมด Manual

